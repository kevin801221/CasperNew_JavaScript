{"ast":null,"code":"var _jsxFileName = \"/Users/kevinluo/application/Casper_final_version/react-frontend/src/components/BatchMode/ImageGrid.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { Trash2, Scissors, Edit, X, Loader } from 'lucide-react';\nimport { useImageContext } from '../../contexts/ImageContext';\nimport useImageEditor from '../../hooks/useImageEditor';\nimport Button from '../common/Button';\n\n/**\n * 批量處理頁面的圖片網格組件\n * @param {Object} props - 組件屬性\n * @param {boolean} props.showBackgroundPreview - 是否顯示背景預覽\n * @param {string} props.backgroundImage - 背景圖片 URL\n * @param {boolean} props.showSizePreview - 是否顯示尺寸調整預覽\n * @param {number} props.canvasWidth - 畫布寬度\n * @param {number} props.canvasHeight - 畫布高度\n * @param {number} props.margin - 邊距\n */\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ImageGrid = ({\n  showBackgroundPreview = false,\n  backgroundImage = null,\n  showSizePreview = false,\n  canvasWidth = 800,\n  canvasHeight = 600,\n  margin = 0\n}) => {\n  _s();\n  const {\n    uploadedImages,\n    selectedImages,\n    toggleImageSelection,\n    deleteSelectedImages,\n    deleteImage,\n    zoomLevel,\n    updateImage\n  } = useImageContext();\n  const {\n    removeBackground,\n    batchRemoveBackground\n  } = useImageEditor();\n  const [processingImages, setProcessingImages] = useState([]);\n  const [isBatchProcessing, setIsBatchProcessing] = useState(false);\n\n  // 處理單個圖片刪除\n  const handleDeleteImage = (e, id) => {\n    e.stopPropagation(); // 防止觸發選擇事件\n    deleteImage(id);\n  };\n\n  // 處理單個圖片去背\n  const handleRemoveBackground = async (e, id) => {\n    e.stopPropagation(); // 防止觸發選擇事件\n    console.log('去背圖片:', id);\n    try {\n      // 設置圖片為處理中狀態\n      setProcessingImages(prev => [...prev, id]);\n\n      // 獲取圖片數據\n      const image = uploadedImages.find(img => img.id === id);\n      if (!image) {\n        console.error('找不到圖片:', id);\n        return;\n      }\n      console.log('準備處理圖片:', image.url);\n\n      // 如果是本地文件 URL，先轉換為完整 URL\n      let imageUrl = image.url;\n      if (imageUrl.startsWith('/') && !imageUrl.startsWith('//')) {\n        const origin = window.location.origin;\n        imageUrl = `${origin}${imageUrl}`;\n        console.log('轉換後的完整 URL:', imageUrl);\n      }\n\n      // 調用去背 API\n      const processedImageUrl = await removeBackground(imageUrl);\n      console.log('去背成功，處理後的 URL 長度:', processedImageUrl.length);\n\n      // 更新圖片數據\n      updateImage(id, {\n        url: processedImageUrl,\n        has_bg_removed: true\n      });\n      console.log('圖片數據已更新');\n    } catch (error) {\n      console.error('圖片去背失敗:', error);\n      alert('圖片去背處理失敗，請稍後再試。');\n    } finally {\n      // 移除處理中狀態\n      setProcessingImages(prev => prev.filter(imgId => imgId !== id));\n    }\n  };\n\n  // 處理單個圖片編輯\n  const handleEditImage = (e, id) => {\n    e.stopPropagation(); // 防止觸發選擇事件\n    console.log('編輯圖片:', id);\n    // 這裡可以添加編輯的邏輯\n  };\n\n  // 處理批量去背\n  const handleBatchRemoveBackground = async () => {\n    if (selectedImages.length === 0 || isBatchProcessing) return;\n    try {\n      setIsBatchProcessing(true);\n\n      // 獲取選中圖片的 URL\n      const imagesToProcess = uploadedImages.filter(img => selectedImages.includes(img.id)).map(img => img.url);\n\n      // 調用批量去背 API\n      const processedImageUrls = await batchRemoveBackground(imagesToProcess);\n\n      // 更新圖片數據\n      selectedImages.forEach((id, index) => {\n        if (index < processedImageUrls.length) {\n          updateImage(id, {\n            url: processedImageUrls[index],\n            has_bg_removed: true\n          });\n        }\n      });\n      alert(`成功處理 ${processedImageUrls.length} 張圖片的背景`);\n    } catch (error) {\n      console.error('批量去背失敗:', error);\n      alert('批量去背處理失敗，請稍後再試。');\n    } finally {\n      setIsBatchProcessing(false);\n    }\n  };\n\n  // 計算圖片尺寸\n  const getImageSize = () => {\n    const baseSize = 180;\n    return {\n      width: baseSize * zoomLevel,\n      height: baseSize * 0.8 * zoomLevel\n    };\n  };\n\n  // 計算預覽畫布尺寸\n  const getPreviewCanvasSize = () => {\n    // 保持畫布比例但適應容器\n    const ratio = canvasWidth / canvasHeight;\n    const baseWidth = 180 * zoomLevel;\n    return {\n      width: baseWidth,\n      height: baseWidth / ratio\n    };\n  };\n  const {\n    width,\n    height\n  } = getImageSize();\n  const previewSize = getPreviewCanvasSize();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex mb-4 items-center justify-between\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center\",\n        children: selectedImages.length > 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"secondary\",\n            onClick: deleteSelectedImages,\n            className: \"mr-2\",\n            children: [/*#__PURE__*/_jsxDEV(Trash2, {\n              size: 16,\n              className: \"mr-1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 167,\n              columnNumber: 17\n            }, this), \"\\u522A\\u9664 (\", selectedImages.length, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleBatchRemoveBackground,\n            className: \"mr-2\",\n            disabled: isBatchProcessing,\n            children: isBatchProcessing ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Loader, {\n                size: 16,\n                className: \"mr-1 animate-spin\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 21\n              }, this), \"\\u8655\\u7406\\u4E2D...\"]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Scissors, {\n                size: 16,\n                className: \"mr-1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 21\n              }, this), \"\\u6279\\u91CF\\u53BB\\u80CC (\", selectedImages.length, \")\"]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid gap-4\",\n      style: {\n        gridTemplateColumns: `repeat(auto-fill, minmax(${width}px, 1fr))`\n      },\n      children: uploadedImages.map(image => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `relative rounded overflow-hidden border-2 transition-all ${selectedImages.includes(image.id) ? 'border-amber-500' : 'border-transparent'}`,\n        style: {\n          height: showSizePreview ? `${previewSize.height}px` : `${height}px`,\n          width: showSizePreview ? `${previewSize.width}px` : 'auto'\n        },\n        onClick: () => toggleImageSelection(image.id),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute top-2 left-2 z-10\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `w-5 h-5 rounded border flex items-center justify-center ${selectedImages.includes(image.id) ? 'bg-amber-500 border-amber-500' : 'border-white bg-black bg-opacity-20'}`,\n            children: selectedImages.includes(image.id) && /*#__PURE__*/_jsxDEV(X, {\n              size: 14,\n              className: \"text-white\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute top-2 right-2 z-10 flex\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"w-6 h-6 rounded-full bg-black bg-opacity-50 flex items-center justify-center text-white mr-1\",\n            onClick: e => handleDeleteImage(e, image.id),\n            title: \"\\u522A\\u9664\",\n            children: /*#__PURE__*/_jsxDEV(Trash2, {\n              size: 14\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"w-6 h-6 rounded-full bg-black bg-opacity-50 flex items-center justify-center text-white mr-1\",\n            onClick: e => handleRemoveBackground(e, image.id),\n            title: \"\\u53BB\\u80CC\",\n            disabled: processingImages.includes(image.id),\n            children: processingImages.includes(image.id) ? /*#__PURE__*/_jsxDEV(Loader, {\n              size: 14,\n              className: \"animate-spin\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(Scissors, {\n              size: 14\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"w-6 h-6 rounded-full bg-black bg-opacity-50 flex items-center justify-center text-white\",\n            onClick: e => handleEditImage(e, image.id),\n            title: \"\\u7DE8\\u8F2F\",\n            children: /*#__PURE__*/_jsxDEV(Edit, {\n              size: 14\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 13\n        }, this), showBackgroundPreview && backgroundImage && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute inset-0 z-0\",\n          style: {\n            backgroundImage: `url(${backgroundImage})`,\n            backgroundSize: 'cover',\n            backgroundPosition: 'center'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 15\n        }, this), showSizePreview && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute z-10\",\n          style: {\n            top: `${margin}px`,\n            left: `${margin}px`,\n            right: `${margin}px`,\n            bottom: `${margin}px`,\n            border: '1px dashed rgba(0,0,0,0.2)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: image.url,\n          alt: image.name || '上傳圖片',\n          className: `${showSizePreview ? 'absolute inset-0 m-auto max-w-full max-h-full z-20' : 'w-full h-full object-contain'}`,\n          style: showSizePreview ? {\n            maxWidth: `calc(100% - ${margin * 2}px)`,\n            maxHeight: `calc(100% - ${margin * 2}px)`\n          } : {}\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 13\n        }, this), image.has_bg_removed && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-2 left-2 bg-amber-500 text-white text-xs px-2 py-1 rounded\",\n          children: \"\\u5DF2\\u53BB\\u80CC\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 15\n        }, this)]\n      }, image.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this), uploadedImages.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-col items-center justify-center h-64 text-gray-500\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mb-2\",\n        children: \"\\u5C1A\\u672A\\u4E0A\\u50B3\\u5716\\u7247\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-sm\",\n        children: \"\\u8ACB\\u4E0A\\u50B3\\u5716\\u7247\\u6216\\u5F9E\\u4E3B\\u9801\\u9762\\u9032\\u5165\\u6279\\u91CF\\u6A21\\u5F0F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 156,\n    columnNumber: 5\n  }, this);\n};\n_s(ImageGrid, \"QSMovBrrSNARmPorec3bbwIdsSE=\", false, function () {\n  return [useImageContext, useImageEditor];\n});\n_c = ImageGrid;\nexport default ImageGrid;\nvar _c;\n$RefreshReg$(_c, \"ImageGrid\");","map":{"version":3,"names":["React","useState","Trash2","Scissors","Edit","X","Loader","useImageContext","useImageEditor","Button","jsxDEV","_jsxDEV","Fragment","_Fragment","ImageGrid","showBackgroundPreview","backgroundImage","showSizePreview","canvasWidth","canvasHeight","margin","_s","uploadedImages","selectedImages","toggleImageSelection","deleteSelectedImages","deleteImage","zoomLevel","updateImage","removeBackground","batchRemoveBackground","processingImages","setProcessingImages","isBatchProcessing","setIsBatchProcessing","handleDeleteImage","e","id","stopPropagation","handleRemoveBackground","console","log","prev","image","find","img","error","url","imageUrl","startsWith","origin","window","location","processedImageUrl","length","has_bg_removed","alert","filter","imgId","handleEditImage","handleBatchRemoveBackground","imagesToProcess","includes","map","processedImageUrls","forEach","index","getImageSize","baseSize","width","height","getPreviewCanvasSize","ratio","baseWidth","previewSize","className","children","variant","onClick","size","fileName","_jsxFileName","lineNumber","columnNumber","disabled","style","gridTemplateColumns","title","backgroundSize","backgroundPosition","top","left","right","bottom","border","src","alt","name","maxWidth","maxHeight","_c","$RefreshReg$"],"sources":["/Users/kevinluo/application/Casper_final_version/react-frontend/src/components/BatchMode/ImageGrid.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { Trash2, Scissors, Edit, X, Loader } from 'lucide-react';\nimport { useImageContext } from '../../contexts/ImageContext';\nimport useImageEditor from '../../hooks/useImageEditor';\nimport Button from '../common/Button';\n\n/**\n * 批量處理頁面的圖片網格組件\n * @param {Object} props - 組件屬性\n * @param {boolean} props.showBackgroundPreview - 是否顯示背景預覽\n * @param {string} props.backgroundImage - 背景圖片 URL\n * @param {boolean} props.showSizePreview - 是否顯示尺寸調整預覽\n * @param {number} props.canvasWidth - 畫布寬度\n * @param {number} props.canvasHeight - 畫布高度\n * @param {number} props.margin - 邊距\n */\nconst ImageGrid = ({ \n  showBackgroundPreview = false, \n  backgroundImage = null,\n  showSizePreview = false,\n  canvasWidth = 800,\n  canvasHeight = 600,\n  margin = 0\n}) => {\n  const { \n    uploadedImages, \n    selectedImages, \n    toggleImageSelection, \n    deleteSelectedImages, \n    deleteImage,\n    zoomLevel,\n    updateImage\n  } = useImageContext();\n  \n  const { removeBackground, batchRemoveBackground } = useImageEditor();\n  const [processingImages, setProcessingImages] = useState([]);\n  const [isBatchProcessing, setIsBatchProcessing] = useState(false);\n\n  // 處理單個圖片刪除\n  const handleDeleteImage = (e, id) => {\n    e.stopPropagation(); // 防止觸發選擇事件\n    deleteImage(id);\n  };\n\n  // 處理單個圖片去背\n  const handleRemoveBackground = async (e, id) => {\n    e.stopPropagation(); // 防止觸發選擇事件\n    console.log('去背圖片:', id);\n    \n    try {\n      // 設置圖片為處理中狀態\n      setProcessingImages(prev => [...prev, id]);\n      \n      // 獲取圖片數據\n      const image = uploadedImages.find(img => img.id === id);\n      if (!image) {\n        console.error('找不到圖片:', id);\n        return;\n      }\n      \n      console.log('準備處理圖片:', image.url);\n      \n      // 如果是本地文件 URL，先轉換為完整 URL\n      let imageUrl = image.url;\n      if (imageUrl.startsWith('/') && !imageUrl.startsWith('//')) {\n        const origin = window.location.origin;\n        imageUrl = `${origin}${imageUrl}`;\n        console.log('轉換後的完整 URL:', imageUrl);\n      }\n      \n      // 調用去背 API\n      const processedImageUrl = await removeBackground(imageUrl);\n      console.log('去背成功，處理後的 URL 長度:', processedImageUrl.length);\n      \n      // 更新圖片數據\n      updateImage(id, {\n        url: processedImageUrl,\n        has_bg_removed: true\n      });\n      \n      console.log('圖片數據已更新');\n    } catch (error) {\n      console.error('圖片去背失敗:', error);\n      alert('圖片去背處理失敗，請稍後再試。');\n    } finally {\n      // 移除處理中狀態\n      setProcessingImages(prev => prev.filter(imgId => imgId !== id));\n    }\n  };\n\n  // 處理單個圖片編輯\n  const handleEditImage = (e, id) => {\n    e.stopPropagation(); // 防止觸發選擇事件\n    console.log('編輯圖片:', id);\n    // 這裡可以添加編輯的邏輯\n  };\n  \n  // 處理批量去背\n  const handleBatchRemoveBackground = async () => {\n    if (selectedImages.length === 0 || isBatchProcessing) return;\n    \n    try {\n      setIsBatchProcessing(true);\n      \n      // 獲取選中圖片的 URL\n      const imagesToProcess = uploadedImages\n        .filter(img => selectedImages.includes(img.id))\n        .map(img => img.url);\n      \n      // 調用批量去背 API\n      const processedImageUrls = await batchRemoveBackground(imagesToProcess);\n      \n      // 更新圖片數據\n      selectedImages.forEach((id, index) => {\n        if (index < processedImageUrls.length) {\n          updateImage(id, {\n            url: processedImageUrls[index],\n            has_bg_removed: true\n          });\n        }\n      });\n      \n      alert(`成功處理 ${processedImageUrls.length} 張圖片的背景`);\n    } catch (error) {\n      console.error('批量去背失敗:', error);\n      alert('批量去背處理失敗，請稍後再試。');\n    } finally {\n      setIsBatchProcessing(false);\n    }\n  };\n\n  // 計算圖片尺寸\n  const getImageSize = () => {\n    const baseSize = 180;\n    return {\n      width: baseSize * zoomLevel,\n      height: baseSize * 0.8 * zoomLevel\n    };\n  };\n\n  // 計算預覽畫布尺寸\n  const getPreviewCanvasSize = () => {\n    // 保持畫布比例但適應容器\n    const ratio = canvasWidth / canvasHeight;\n    const baseWidth = 180 * zoomLevel;\n    return {\n      width: baseWidth,\n      height: baseWidth / ratio\n    };\n  };\n\n  const { width, height } = getImageSize();\n  const previewSize = getPreviewCanvasSize();\n\n  return (\n    <div className=\"p-4\">\n      {/* 頂部操作欄 */}\n      <div className=\"flex mb-4 items-center justify-between\">\n        <div className=\"flex items-center\">\n          {selectedImages.length > 0 && (\n            <>\n              <Button \n                variant=\"secondary\"\n                onClick={deleteSelectedImages}\n                className=\"mr-2\"\n              >\n                <Trash2 size={16} className=\"mr-1\" />\n                刪除 ({selectedImages.length})\n              </Button>\n              \n              <Button \n                variant=\"primary\"\n                onClick={handleBatchRemoveBackground}\n                className=\"mr-2\"\n                disabled={isBatchProcessing}\n              >\n                {isBatchProcessing ? (\n                  <>\n                    <Loader size={16} className=\"mr-1 animate-spin\" />\n                    處理中...\n                  </>\n                ) : (\n                  <>\n                    <Scissors size={16} className=\"mr-1\" />\n                    批量去背 ({selectedImages.length})\n                  </>\n                )}\n              </Button>\n            </>\n          )}\n        </div>\n      </div>\n      \n      {/* 圖片網格 */}\n      <div \n        className=\"grid gap-4\" \n        style={{ \n          gridTemplateColumns: `repeat(auto-fill, minmax(${width}px, 1fr))`,\n        }}\n      >\n        {uploadedImages.map((image) => (\n          <div \n            key={image.id} \n            className={`relative rounded overflow-hidden border-2 transition-all ${\n              selectedImages.includes(image.id) ? 'border-amber-500' : 'border-transparent'\n            }`}\n            style={{\n              height: showSizePreview ? `${previewSize.height}px` : `${height}px`,\n              width: showSizePreview ? `${previewSize.width}px` : 'auto'\n            }}\n            onClick={() => toggleImageSelection(image.id)}\n          >\n            {/* 選擇框 */}\n            <div className=\"absolute top-2 left-2 z-10\">\n              <div \n                className={`w-5 h-5 rounded border flex items-center justify-center ${\n                  selectedImages.includes(image.id) \n                    ? 'bg-amber-500 border-amber-500' \n                    : 'border-white bg-black bg-opacity-20'\n                }`}\n              >\n                {selectedImages.includes(image.id) && (\n                  <X size={14} className=\"text-white\" />\n                )}\n              </div>\n            </div>\n            \n            {/* 功能按鈕 */}\n            <div className=\"absolute top-2 right-2 z-10 flex\">\n              <button \n                className=\"w-6 h-6 rounded-full bg-black bg-opacity-50 flex items-center justify-center text-white mr-1\"\n                onClick={(e) => handleDeleteImage(e, image.id)}\n                title=\"刪除\"\n              >\n                <Trash2 size={14} />\n              </button>\n              <button \n                className=\"w-6 h-6 rounded-full bg-black bg-opacity-50 flex items-center justify-center text-white mr-1\"\n                onClick={(e) => handleRemoveBackground(e, image.id)}\n                title=\"去背\"\n                disabled={processingImages.includes(image.id)}\n              >\n                {processingImages.includes(image.id) ? (\n                  <Loader size={14} className=\"animate-spin\" />\n                ) : (\n                  <Scissors size={14} />\n                )}\n              </button>\n              <button \n                className=\"w-6 h-6 rounded-full bg-black bg-opacity-50 flex items-center justify-center text-white\"\n                onClick={(e) => handleEditImage(e, image.id)}\n                title=\"編輯\"\n              >\n                <Edit size={14} />\n              </button>\n            </div>\n            \n            {/* 背景預覽 */}\n            {showBackgroundPreview && backgroundImage && (\n              <div \n                className=\"absolute inset-0 z-0\" \n                style={{\n                  backgroundImage: `url(${backgroundImage})`,\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center'\n                }}\n              ></div>\n            )}\n            \n            {/* 尺寸調整預覽 */}\n            {showSizePreview && (\n              <div \n                className=\"absolute z-10\"\n                style={{\n                  top: `${margin}px`,\n                  left: `${margin}px`,\n                  right: `${margin}px`,\n                  bottom: `${margin}px`,\n                  border: '1px dashed rgba(0,0,0,0.2)'\n                }}\n              ></div>\n            )}\n            \n            {/* 圖片 */}\n            <img \n              src={image.url} \n              alt={image.name || '上傳圖片'} \n              className={`${showSizePreview ? 'absolute inset-0 m-auto max-w-full max-h-full z-20' : 'w-full h-full object-contain'}`}\n              style={showSizePreview ? {\n                maxWidth: `calc(100% - ${margin * 2}px)`,\n                maxHeight: `calc(100% - ${margin * 2}px)`\n              } : {}}\n            />\n            \n            {/* 去背標記 */}\n            {image.has_bg_removed && (\n              <div className=\"absolute bottom-2 left-2 bg-amber-500 text-white text-xs px-2 py-1 rounded\">\n                已去背\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n      \n      {/* 空狀態 */}\n      {uploadedImages.length === 0 && (\n        <div className=\"flex flex-col items-center justify-center h-64 text-gray-500\">\n          <p className=\"mb-2\">尚未上傳圖片</p>\n          <p className=\"text-sm\">請上傳圖片或從主頁面進入批量模式</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageGrid;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}